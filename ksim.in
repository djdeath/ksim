#!/bin/bash
# -*- mode: sh -*-

prefix=@prefix@
exec_prefix=@exec_prefix@
libdir=@libdir@

function show_help() {
    cat <<EOF
Usage: ksim [OPTION]... [--] COMMAND ARGUMENTS

Run COMMAND with ARGUMENTS and under the ksim simulator.

  -v                 Enable verbose output

      --help         Display this help message and exit

EOF

    exit 0
}

args=
device=0

while true; do
      case "$1" in
	  -v)
	      args="verbose;"
	      shift 1
	      ;;
	  --help)
	      show_help
	      ;;
	  --)
	      shift
	      break
	      ;;
	  -*)
	      echo "ksim: invalid option: $1"
	      echo
	      show_help
	      ;;
	  *)
	      break
	      ;;
      esac
done

[ -z $1 ] && show_help

test -f .libs/ksim.so && libdir=.libs

LD_PRELOAD=${libdir}/ksim.so${LD_PPRELOAD:+:${LD_PRELOAD}} \
	KSIM_ARGS="$args" \
	exec -- "$@"
